namespace seq_test6

// Test: return r2 after two performs (should work like seq_test3)

enum Ask {
    Get {}
}

protocol Handler(T) {
    fn handle(self, op, resume)
}

struct SimpleHandler {}

extend SimpleHandler with Handler(Ask) {
    fn handle(self, op, resume) {
        println("Handler")
        resume(10)
    }
}

fn main() {
    println("Start")

    let handler = SimpleHandler {}

    let result = handle Handler(Ask) with handler {
        println("First")
        let r1 = perform Ask.Get {}
        println("r1 =", r1)

        println("Second")
        let r2 = perform Ask.Get {}
        println("r2 =", r2)

        // Return r2 only
        r2
    }

    println("Done:", result)
}
