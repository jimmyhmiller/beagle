namespace async_file_io_test

use beagle.async as async
use beagle.effect as effect
use beagle.core as core

// Test async file I/O using the implicit async handler

fn main() {
    let test_path = "/tmp/beagle_async_test.txt"
    let content = "Hello from async file I/O!"

    // Write file
    println("Writing file...")
    let write_result = async/write-file(test_path, content)
    match write_result {
        Result.Ok { value } => {
            println("Write OK, bytes: ", value)
        },
        Result.Err { error } => {
            println("Write ERROR: ", error)
        }
    }

    // Read file
    println("Reading file...")
    let read_result = async/read-file(test_path)
    match read_result {
        Result.Ok { value } => {
            println("Read OK: ", value)
        },
        Result.Err { error } => {
            println("Read ERROR: ", error)
        }
    }

    // Get file size
    println("Getting file size...")
    let size_result = async/file-size(test_path)
    match size_result {
        Result.Ok { value } => {
            println("Size: ", value)
        },
        Result.Err { error } => {
            println("Size ERROR: ", error)
        }
    }

    // Delete file
    println("Deleting file...")
    let delete_result = async/delete-file(test_path)
    match delete_result {
        Result.Ok { value } => {
            println("Delete OK")
        },
        Result.Err { error } => {
            println("Delete ERROR: ", error)
        }
    }

    println("Done!")
}

// @beagle.core.snapshot
// Writing file...
// Write OK, bytes:  26
// Reading file...
// Read OK:  Hello from async file I/O!
// Getting file size...
// Size:  26
// Deleting file...
// Delete OK
// Done!
