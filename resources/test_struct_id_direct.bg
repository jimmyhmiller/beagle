namespace test_struct_id_direct

import "beagle.primitive" as primitive
import "beagle.core" as core
import "generate_warning_for_test" as warn_gen

fn main() {
    // Trigger a compiler warning
    eval("generate_warning_for_test/main()")

    // Get warnings
    let warnings_vec = core/compiler-warnings()

    println("Number of warnings:")
    println(core/length(warnings_vec))

    if core/length(warnings_vec) > 0 {
        let warning = core/get(warnings_vec, 0)

        println("Warning struct_id (raw from heap):")
        let raw_id = primitive/read_struct_id(warning)
        println(raw_id)

        println("CompilerWarning.id:")
        println(core/CompilerWarning.id)

        println("Do they match?")
        println(raw_id == core/CompilerWarning.id)

        // If double-tagged, raw_id would be (6 << 3) = 48 instead of 6
        println("Would be 48 if double-tagged (6 << 3):")
        println(raw_id == 48)
    }

    "done"
}

// Expect
// Number of warnings:
// 1
// Warning struct_id (raw from heap):
// 6
// CompilerWarning.id:
// 6
// Do they match?
// true
// Would be 48 if double-tagged (6 << 3):
// false
// done
