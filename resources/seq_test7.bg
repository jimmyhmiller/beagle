namespace seq_test7

use beagle.effect as effect

// Test: return r1 after two performs

enum Ask {
    Get {}
}

struct SimpleHandler {}

extend SimpleHandler with effect/Handler(Ask) {
    fn handle(self, op, resume) {
        println("Handler")
        resume(10)
    }
}

fn main() {
    println("Start")

    let handler = SimpleHandler {}

    let result = handle effect/Handler(Ask) with handler {
        println("First")
        let r1 = perform Ask.Get {}
        println("r1 =", r1)

        println("Second")
        let r2 = perform Ask.Get {}
        println("r2 =", r2)

        // Return r1 (from first perform)
        r1
    }

    println("Done:", result)
}
