namespace extra-map-test
import "beagle.builtin" as builtin
import "beagle.primitive" as primitive
import "raw-mutable-array" as array

// DISABLED: This test accessed internal HAMT node structures from the old Beagle
// implementation. With Rust-backed persistent collections, these internals are not exposed.
// The test is no longer applicable.

fn test-assoc-node-bitmap() {
    let pm = pm/assoc(pm/map(), "key1", "value1")
    let added-leaf-box = array/new-array(1)
    array/write-field(added-leaf-box, 0, 0)
    let h = builtin/hash("key2")
    let result = pm/assoc-node(pm.root, 0, h, "key2", "value2", added-leaf-box)
    println(result)
    println(array/read-field(added-leaf-box, 0))
}


fn main() {
    test-assoc-node-bitmap()
}

// Expect
// BitmapIndexedNode { bit-map: 134219776, children: [ BitmapIndexedNode { bit-map: 2048, children: [ PairNode { key: "key2", val: "value2" } ] }, PairNode { key: "key1", val: "value1" } ] }
// 1
