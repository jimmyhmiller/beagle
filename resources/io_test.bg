namespace io-test

use beagle.io as io

fn test_file_write_read() {
    println("Testing file write/read...")

    // Write to a temp file
    let file_result = io/open("/tmp/beagle_io_test.txt", "w")
    match file_result {
        Result.Ok { value } => {
            let file = value
            io/write-string(file, "Hello from Beagle!\n")
            io/write-string(file, "Second line\n")
            io/close(file)
            println("Write successful")
        },
        Result.Err { error } => {
            println("Failed to open file for writing: ", error)
        }
    }

    // Read it back
    let file_result = io/open("/tmp/beagle_io_test.txt", "r")
    match file_result {
        Result.Ok { value } => {
            let file = value
            let line1 = io/read-line(file, 256)
            match line1 {
                Result.Ok { value } => println("Line 1: ", value),
                Result.Err { error } => println("Read error: ", error)
            }
            let line2 = io/read-line(file, 256)
            match line2 {
                Result.Ok { value } => println("Line 2: ", value),
                Result.Err { error } => println("Read error: ", error)
            }
            io/close(file)
            println("Read successful")
        },
        Result.Err { error } => {
            println("Failed to open file for reading: ", error)
        }
    }
}

fn test_stderr() {
    println("Testing stderr output...")
    let result = io/write-stderr("This goes to stderr\n")
    match result {
        Result.Ok { value } => println("Wrote ", value, " bytes to stderr"),
        Result.Err { error } => println("stderr error: ", error)
    }
}

fn test_result_helpers() {
    println("Testing Result helpers...")

    // ok and err are global functions from std.bg, not io/ namespace
    let good = ok(42)
    let bad = err(-1)

    println("ok?(good) = ", ok?(good))
    println("ok?(bad) = ", ok?(bad))
    println("unwrap(good) = ", unwrap(good))
}

fn main() {
    println("=== Beagle IO Tests ===")
    test_result_helpers()
    test_file_write_read()
    test_stderr()
    println("=== Tests Complete ===")
}

// Expect
// === Beagle IO Tests ===
// Testing Result helpers...
// ok?(good) =  true
// ok?(bad) =  false
// unwrap(good) =  42
// Testing file write/read...
// Write successful
// Line 1:  Hello from Beagle!
//
// Line 2:  Second line
//
// Read successful
// Testing stderr output...
// Wrote  20  bytes to stderr
// === Tests Complete ===
