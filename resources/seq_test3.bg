namespace seq_test3

// Simplest sequential effects test - just get the value

enum Ask {
    Get {}
}

protocol Handler(T) {
    fn handle(self, op, resume)
}

struct SimpleHandler {}

extend SimpleHandler with Handler(Ask) {
    fn handle(self, op, resume) {
        println("Handler")
        resume(42)
    }
}

fn main() {
    println("Start")

    let handler = SimpleHandler {}

    let result = handle Handler(Ask) with handler {
        println("First")
        let r1 = perform Ask.Get {}
        println("r1 =", r1)

        println("Second")
        let r2 = perform Ask.Get {}
        println("r2 =", r2)

        r2
    }

    println("Done:", result)
}
