namespace test_warning_debug

use beagle.primitive as primitive
use beagle.core as core

fn main() {
    // Trigger a diagnostic by evaling code with non-exhaustive match
    eval("
        enum MyEnum {
            Variant1,
            Variant2,
            Variant3
        }

        fn test_match(val) {
            match val {
                MyEnum.Variant1 => \"one\",
                MyEnum.Variant2 => \"two\"
            }
        }

        test_match(MyEnum.Variant1)
    ")

    let diags = core/diagnostics()
    println("Number of diagnostics:")
    println(core/length(diags))

    if core/length(diags) > 0 {
        let first = core/get(diags, 0)
        println("Got first diagnostic object")
        println("Type check - is heap object?:")
        println(primitive/is_object(first))

        // Try to read the struct_id carefully
        println("About to read struct_id...")
        let id = primitive/read_struct_id(first)
        println("struct_id:")
        println(id)
    }

    "done"
}
