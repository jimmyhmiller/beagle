namespace timer_test

use beagle.core as core

fn main() {
    // Create an event loop
    let loop_id = core/event-loop-create(2)
    println("Event loop created:", loop_id > 0)

    // Set a timer for 50ms
    let timer_id = core/timer-set(loop_id, 50, 12345)
    println("Timer set:", timer_id > 0)

    // Poll with short timeout - timer shouldn't be ready yet
    core/event-loop-run-once(loop_id, 10)
    let count1 = core/timer-completed-count(loop_id)
    println("Completed before delay:", count1 == 0)

    // Wait for timer to expire
    core/event-loop-run-once(loop_id, 100)
    let count2 = core/timer-completed-count(loop_id)
    println("Completed after delay:", count2 == 1)

    // Pop the completed timer
    let future_atom = core/timer-pop-completed(loop_id)
    println("Future atom:", future_atom == 12345)

    // Clean up
    core/event-loop-destroy(loop_id)
    println("done")
}

// Expect
// Event loop created: true
// Timer set: true
// Completed before delay: true
// Completed after delay: true
// Future atom: true
// done
