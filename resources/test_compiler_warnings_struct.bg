namespace test

import "beagle.core" as core

enum Color {
    Red,
    Green,
    Blue,
}

fn test_match(c) {
    match c {
        Color.Red => "red",
        Color.Green => "green",
        // Missing Blue - triggers NonExhaustiveMatch diagnostic
    }
}

fn main() {
    let diags = diagnostics()
    let count = length(diags)

    println("Diagnostic count:")
    println(count)

    if count > 0 {
        let d = get(diags, 0)
        println("Severity:")
        println(d.severity)
        println("Kind:")
        println(d.kind)
        println("File:")
        println(d.file-name)
        println("Line:")
        println(d.line)
        println("Column:")
        println(d.column)
        println("Message:")
        println(d.message)

        if d.enum-name != null {
            println("Enum:")
            println(d.enum-name)
            println("Missing variants count:")
            println(length(d.missing-variants))
            println("First missing variant:")
            println(get(d.missing-variants, 0))
        }
    }
}

// Expect
// Diagnostic count:
// 1
// Severity:
// DiagnosticSeverity.warning
// Kind:
// NonExhaustiveMatch
// File:
// resources/test_compiler_warnings_struct.bg
// Line:
// 12
// Column:
// 10
// Message:
// Non-exhaustive match on enum 'Color'. Missing variants: Blue
// Enum:
// Color
// Missing variants count:
// 1
// First missing variant:
// Blue
