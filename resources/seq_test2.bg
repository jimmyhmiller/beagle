namespace seq_test2

// Even simpler sequential effects test

enum Ask {
    Get {}
}

protocol Handler(T) {
    fn handle(self, op, resume)
}

struct SimpleHandler {}

extend SimpleHandler with Handler(Ask) {
    fn handle(self, op, resume) {
        println("Handler called")
        resume(42)
    }
}

fn main() {
    println("Start")

    let handler = SimpleHandler {}

    let result = handle Handler(Ask) with handler {
        println("Before first perform")
        let r1 = perform Ask.Get {}
        println("After first, r1 =", r1)

        println("Before second perform")
        let r2 = perform Ask.Get {}
        println("After second, r2 =", r2)

        r1 + r2
    }

    println("Final:", result)
}
