namespace single_effect_test

// Single effect test

enum Counter {
    Inc {}
}

protocol Handler(T) {
    fn handle(self, op, resume)
}

struct CountHandler {
    count
}

extend CountHandler with Handler(Counter) {
    fn handle(self, op, resume) {
        println("Handler called")
        resume(42)
    }
}

fn main() {
    println("Starting test")

    let handler = CountHandler { count: 0 }

    let result = handle Handler(Counter) with handler {
        println("About to perform")
        let r1 = perform Counter.Inc {}
        println("Got result:", r1)
        r1
    }

    println("Final result:", result)
}
