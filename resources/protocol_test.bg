namespace protocol-test

use beagle.builtin as builtin
use beagle.primitive as primitive
use beagle.core as core


struct Point {
    x
    y
}

struct Size {
    width
    height
}

protocol Axis {
    fn get-x(self)
    fn get-y(self)
}


extend Point with Axis {
    fn get-x(self) {
        self.x
    }

    fn get-y(self) {
        self.y
    }
}

extend Size with Axis {
    fn get-x(self) {
        self.width
    }

    fn get-y(self) {
        self.height
    }
}


protocol Format {
    fn format(self) {
        "no format"
    }
}

extend String with Format {
    fn format(self) {
        self
    }
}


fn main() {
    println(core/PersistentVector.name)
    println(Indexed)
    let x = [2];
    println(x[0])
    // Vector literals now create Rust-backed PersistentVector (type_id=20)
    // Use beagle.core/PersistentVector for instance checking
    println(instance-of(x, core/PersistentVector))
    println(instance-of(x, core/PersistentVector))
    println(instance-of(2, core/PersistentVector))


    let point = Point {
        x: 1,
        y: 2
    }

    let size = Size {
        width: 3,
        height: 4
    }

    println(get-x(point))
    println(get-y(point))
    println(get-x(size))
    println(get-y(size))
    println(format("test"))
    println(format(2))
    "done"
}

// Expect
// PersistentVector
// Protocol { name: "beagle.core/Indexed" }
// 2
// true
// true
// false
// 1
// 2
// 3
// 4
// test
// no format
